{"ast":null,"code":"import { useEffect, useState, useMemo } from 'react';\nimport decode from './decode';\nimport { isBlurhashString } from '../resolveSources';\nconst DEFAULT_SIZE = {\n  width: 32,\n  height: 32\n};\nconst scaleRatio = 10;\nexport function useBlurhash(blurhash, punch = 1) {\n  punch = punch || 1;\n  const [uri, setUri] = useState(null);\n  const isBlurhash = (blurhash?.uri && isBlurhashString(blurhash.uri)) ?? false;\n  useEffect(() => {\n    let isCanceled = false;\n    if (!blurhash || !blurhash.uri || !isBlurhash) {\n      return;\n    }\n    const strippedBlurhashString = blurhash.uri.replace(/blurhash:\\//, '');\n    const pixels = decode(strippedBlurhashString, blurhash.width ?? DEFAULT_SIZE.width, blurhash.height ?? DEFAULT_SIZE.height, punch);\n    const canvas = document.createElement('canvas');\n    const upscaledCanvas = document.createElement('canvas');\n    canvas.width = blurhash.width ?? DEFAULT_SIZE.width;\n    canvas.height = blurhash.height ?? DEFAULT_SIZE.height;\n    upscaledCanvas.width = (blurhash.width ?? DEFAULT_SIZE.width) * scaleRatio;\n    upscaledCanvas.height = (blurhash.height ?? DEFAULT_SIZE.height) * scaleRatio;\n    const context = canvas.getContext('2d');\n    if (!context) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    const imageData = context.createImageData(canvas.width, canvas.height);\n    imageData.data.set(pixels);\n    context.putImageData(imageData, 0, 0);\n    const upscaledContext = upscaledCanvas.getContext('2d');\n    if (!upscaledContext) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    upscaledContext.scale(scaleRatio, scaleRatio);\n    upscaledContext.drawImage(canvas, 0, 0);\n    upscaledCanvas.toBlob(blob => {\n      if (!isCanceled) {\n        setUri(oldUrl => {\n          if (oldUrl) {\n            URL.revokeObjectURL(oldUrl);\n          }\n          return blob ? URL.createObjectURL(blob) : oldUrl;\n        });\n      }\n    });\n    return function cleanupBlurhash() {\n      isCanceled = true;\n      setUri(oldUrl => {\n        if (oldUrl) {\n          URL.revokeObjectURL(oldUrl);\n        }\n        return null;\n      });\n    };\n  }, [blurhash?.uri, blurhash?.height, blurhash?.width, punch, isBlurhash]);\n  const source = useMemo(() => uri ? {\n    uri\n  } : null, [uri]);\n  return [source, isBlurhash];\n}","map":{"version":3,"names":["useEffect","useState","useMemo","decode","isBlurhashString","DEFAULT_SIZE","width","height","scaleRatio","useBlurhash","blurhash","punch","uri","setUri","isBlurhash","isCanceled","strippedBlurhashString","replace","pixels","canvas","document","createElement","upscaledCanvas","context","getContext","console","warn","imageData","createImageData","data","set","putImageData","upscaledContext","scale","drawImage","toBlob","blob","oldUrl","URL","revokeObjectURL","createObjectURL","cleanupBlurhash","source"],"sources":["/Users/shubhamsharma/Downloads/newApp/node_modules/expo-image/src/utils/blurhash/useBlurhash.tsx"],"sourcesContent":["// adapted from https://gist.github.com/ngbrown/d62eb518753378eb0a9bf02bb4723235\n// modified from https://gist.github.com/WorldMaker/a3cbe0059acd827edee568198376b95a\n// https://github.com/woltapp/react-blurhash/issues/3\n\nimport { useEffect, useState, useMemo } from 'react';\n\nimport decode from './decode';\nimport { isBlurhashString } from '../resolveSources';\n\nconst DEFAULT_SIZE = {\n  width: 32,\n  height: 32,\n};\n\n// We scale up the canvas to avoid an irritating visual glitch when animating in Chrome.\nconst scaleRatio = 10;\n\nexport function useBlurhash(\n  blurhash: { uri?: string; width?: number; height?: number } | undefined | null,\n  punch: number = 1\n) {\n  punch = punch || 1;\n\n  const [uri, setUri] = useState<string | null>(null);\n  const isBlurhash = (blurhash?.uri && isBlurhashString(blurhash.uri)) ?? false;\n  useEffect(() => {\n    let isCanceled = false;\n\n    if (!blurhash || !blurhash.uri || !isBlurhash) {\n      return;\n    }\n    const strippedBlurhashString = blurhash.uri.replace(/blurhash:\\//, '');\n\n    const pixels = decode(\n      strippedBlurhashString,\n      blurhash.width ?? DEFAULT_SIZE.width,\n      blurhash.height ?? DEFAULT_SIZE.height,\n      punch\n    );\n\n    const canvas = document.createElement('canvas');\n    const upscaledCanvas = document.createElement('canvas');\n    canvas.width = blurhash.width ?? DEFAULT_SIZE.width;\n    canvas.height = blurhash.height ?? DEFAULT_SIZE.height;\n    upscaledCanvas.width = (blurhash.width ?? DEFAULT_SIZE.width) * scaleRatio;\n    upscaledCanvas.height = (blurhash.height ?? DEFAULT_SIZE.height) * scaleRatio;\n    const context = canvas.getContext('2d');\n    if (!context) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    const imageData = context.createImageData(canvas.width, canvas.height);\n    imageData.data.set(pixels);\n    context.putImageData(imageData, 0, 0);\n    const upscaledContext = upscaledCanvas.getContext('2d');\n    if (!upscaledContext) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    upscaledContext.scale(scaleRatio, scaleRatio);\n    upscaledContext.drawImage(canvas, 0, 0);\n    upscaledCanvas.toBlob((blob) => {\n      if (!isCanceled) {\n        setUri((oldUrl) => {\n          if (oldUrl) {\n            URL.revokeObjectURL(oldUrl);\n          }\n          return blob ? URL.createObjectURL(blob) : oldUrl;\n        });\n      }\n    });\n\n    return function cleanupBlurhash() {\n      isCanceled = true;\n      setUri((oldUrl) => {\n        if (oldUrl) {\n          URL.revokeObjectURL(oldUrl);\n        }\n        return null;\n      });\n    };\n  }, [blurhash?.uri, blurhash?.height, blurhash?.width, punch, isBlurhash]);\n  const source = useMemo(() => (uri ? { uri } : null), [uri]);\n  return [source, isBlurhash] as const;\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{"hasCjsExports":false},"sourceType":"module","externalDependencies":[]}